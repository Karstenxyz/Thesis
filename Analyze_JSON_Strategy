import pandas as pd

# Load the uploaded Excel file
file_path = '/mnt/data/Kopie van combined_output_proposals_plus_strategies (1).xlsx'
xls = pd.ExcelFile(file_path)

# Load the sheet into a DataFrame
df = pd.read_excel(file_path, sheet_name='Sheet2')

# Function to extract networks, strategies, and symbols from a JSON string
def extract_from_json(json_str):
    data = eval(json_str)  # Using eval to convert string representation of list to actual list
    networks = []
    strategies = []
    symbols = []
    
    for entry in data:
        network = entry.get('network', '')
        symbol = entry['params'].get('symbol', '')
        if 'strategies' in entry['params']:
            for strategy in entry['params']['strategies']:
                networks.append(str(strategy.get('network', '')))
                strategies.append(str(strategy.get('name', '')))
                symbols.append(symbol)
        else:
            networks.append(str(network))
            symbols.append(symbol)
    
    return ','.join(networks), ','.join(strategies), ','.join(symbols)

# Extracting data from the 'strategies' column
df[['networks', 'strategies', 'symbols']] = df['strategies'].apply(lambda x: pd.Series(extract_from_json(x)))

# Display the new DataFrame with the extracted columns
import ace_tools as tools; tools.display_dataframe_to_user(name="Extracted Networks, Strategies, and Symbols", dataframe=df)

# Saving the DataFrame to a new Excel file
output_file_path = '/mnt/data/Extracted_Networks_Strategies_Symbols.xlsx'
df.to_excel(output_file_path, index=False)

output_file_path
